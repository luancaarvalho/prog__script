{"version":3,"sources":["./src/app/shared/map/map.component.ts","./src/app/shared/map/map.component.html","./src/app/shared/map/map-point.component.ts"],"names":[],"mappings":"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","file":"shared-map-map-component.js","sourcesContent":["/// <reference path=\"../../../../node_modules/@types/googlemaps/index.d.ts\" />\n\nimport {\n  Component, OnInit, AfterContentInit, Input, ViewChild,\n  ContentChildren, ElementRef, QueryList, ChangeDetectionStrategy\n} from '@angular/core';\n\nimport { debounceTime, startWith } from 'rxjs/operators';\nimport { MapPointComponent } from './map-point.component';\nimport { IMapDataPoint } from '../../shared/interfaces';\n\n@Component({\n  selector: 'cm-map',\n  templateUrl: './map.component.html',\n  // When using OnPush detectors, then the framework will check an OnPush\n  // component when any of its input properties changes, when it fires\n  // an event, or when an observable fires an event ~ Victor Savkin (Angular Team)\n  changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class MapComponent implements OnInit, AfterContentInit {\n\n  private isEnabled: boolean;\n  private loadingScript: boolean;\n  private map: google.maps.Map;\n  private markers: google.maps.Marker[] = [];\n  mapHeight: string;\n  mapWidth: string;\n\n  @Input() height: number;\n  @Input() width: number;\n  @Input() latitude = 34.5133;\n  @Input() longitude = -94.1629;\n  @Input() markerText = 'Your Location';\n  @Input() zoom = 8;\n  private _dataPoints: IMapDataPoint[] = null;\n  @Input() public get dataPoints() {\n    return this._dataPoints;\n  }\n\n  public set dataPoints(value: any[]) {\n    this._dataPoints = value;\n    this.renderMapPoints();\n  }\n\n  // Necessary since a map rendered while container is hidden\n  // will not load the map tiles properly and show a grey screen\n  @Input() get enabled(): boolean {\n    return this.isEnabled;\n  }\n\n  set enabled(isEnabled: boolean) {\n    this.isEnabled = isEnabled;\n    this.init();\n  }\n\n  @ViewChild('mapContainer', { static: true }) mapDiv: ElementRef;\n  @ContentChildren(MapPointComponent) mapPoints: QueryList<MapPointComponent>;\n\n  constructor() { }\n\n  ngOnInit() {\n    if (this.latitude && this.longitude) {\n      if (this.mapHeight && this.mapWidth) {\n        this.mapHeight = this.height + 'px';\n        this.mapWidth = this.width + 'px';\n      } else {\n        const hw = this.getWindowHeightWidth(this.mapDiv.nativeElement.ownerDocument);\n        this.mapHeight = hw.height / 2 + 'px';\n        this.mapWidth = hw.width + 'px';\n      }\n    }\n  }\n\n  ngAfterContentInit() {\n    this.mapPoints.changes\n        .pipe(\n          debounceTime(500)\n        )\n        .subscribe(() => {\n          if (this.enabled) { \n            this.renderMapPoints(); \n          }\n        });\n  }\n\n  init() {\n    // Need slight delay to avoid grey box when google script has previously been loaded.\n    // Otherwise map <div> container may not be visible yet which causes the grey box.\n    setTimeout(() => {\n      this.ensureScript();\n    }, 200);\n  }\n\n  private getWindowHeightWidth(document: HTMLDocument) {\n    let width = window.innerWidth\n      || document.documentElement.clientWidth\n      || document.body.clientWidth;\n\n    const height = window.innerHeight\n      || document.documentElement.clientHeight\n      || document.body.clientHeight;\n\n    if (width > 900) { width = 900; }\n\n    return { height: height, width: width };\n  }\n\n  private ensureScript() {\n    this.loadingScript = true;\n    const document = this.mapDiv.nativeElement.ownerDocument;\n    const script = <HTMLScriptElement>document.querySelector('script[id=\"googlemaps\"]');\n    if (script) {\n      if (this.isEnabled) { this.renderMap(); }\n    } else {\n      const mapsScript = document.createElement('script');\n      mapsScript.id = 'googlemaps';\n      mapsScript.type = 'text/javascript';\n      mapsScript.async = true;\n      mapsScript.defer = true;\n      mapsScript.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyCG1KDldeF_2GzaTXrEHR0l6cyCS7AnmBw';\n      mapsScript.onload = () => {\n        this.loadingScript = false;\n        if (this.isEnabled) { this.renderMap(); }\n      };\n      document.body.appendChild(mapsScript);\n    }\n  }\n\n  private renderMap() {\n    const latlng = this.createLatLong(this.latitude, this.longitude);\n    const options = {\n      zoom: this.zoom,\n      center: latlng,\n      mapTypeControl: true,\n      mapTypeId: google.maps.MapTypeId.ROADMAP\n    };\n\n    this.map = new google.maps.Map(this.mapDiv.nativeElement, options);\n\n    // See if we have any mapPoints (child content) or dataPoints (@Input property)\n    if ((this.mapPoints && this.mapPoints.length) || (this.dataPoints && this.dataPoints.length)) {\n      this.renderMapPoints();\n    } else {\n      this.createMarker(latlng, this.markerText);\n    }\n  }\n\n  private createLatLong(latitude: number, longitude: number) {\n    return (latitude && longitude) ? new google.maps.LatLng(latitude, longitude) : null;\n  }\n\n  private renderMapPoints() {\n    if (this.map) {\n      this.clearMapPoints();\n\n      // lon/lat can be passed as child content or via the dataPoints @Input property\n      const mapPoints = (this.mapPoints && this.mapPoints.length) ? this.mapPoints : this.dataPoints;\n\n      if (mapPoints) {\n        for (const point of mapPoints) {\n          let markerText = (point.markerText) ? point.markerText : `<h3>${point.firstName} ${point.lastName}</h3>`;\n          const mapPointLatlng = this.createLatLong(point.latitude, point.longitude);\n          this.createMarker(mapPointLatlng, markerText);\n        }\n      }\n    }\n  }\n\n  private clearMapPoints() {\n    this.markers.forEach((marker: google.maps.Marker) => {\n      marker.setMap(null);\n    });\n    this.markers = [];\n  }\n\n  private createMarker(position: google.maps.LatLng, title: string) {\n    const infowindow = new google.maps.InfoWindow({\n      content: title\n    });\n\n    const marker = new google.maps.Marker({\n      position: position,\n      map: this.map,\n      title: title,\n      animation: google.maps.Animation.DROP\n    });\n\n    this.markers.push(marker);\n\n    marker.addListener('click', () => {\n      infowindow.open(this.map, marker);\n    });\n  }\n}\n","<div #mapContainer [style.height]=\"mapHeight\" [style.width]=\"mapWidth\">Map Loading....</div>","import { Component, OnInit, Input } from '@angular/core';\n\n@Component({\n  selector: 'cm-map-point',\n  template: ``\n})\nexport class MapPointComponent implements OnInit {\n\n  @Input() longitude: number;\n  @Input() latitude: number;\n  @Input() markerText: string;\n\n  constructor() { }\n\n  ngOnInit() {\n\n  }\n\n}\n"],"sourceRoot":"webpack:///"}